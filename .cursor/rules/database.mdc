---
description: Database conventions for AnnoBib
globs: server/database/**
---

# Database Context

AnnoBib uses PostgreSQL 18 with Drizzle ORM.

## Key Files

- `server/database/schema.ts` - All table definitions (Drizzle schema)
- `server/database/client.ts` - Database connection pool
- `server/database/migrations/` - SQL migration files (generated by drizzle-kit)
- `drizzle.config.ts` - Drizzle Kit configuration (at project root)

## Extensions

- `pgvector` - Vector similarity search for semantic embeddings
- `uuid-ossp` - UUID generation for primary keys

## Core Tables

- `users` - Auth, profile, subscription tier
- `entries` - Bibliographic sources (books, articles, websites, etc.)
- `projects` - User-created research projects
- `entryProjects` - Many-to-many: entries <-> projects
- `tags`, `entryTags` - Tagging system
- `annotations` - Notes, highlights, comments on entries
- `veritasScores` - AI credibility scoring
- `subscriptions` - Stripe subscription state
- `citationStyles` - Custom CSL citation styles

## Conventions

- All tables use UUID primary keys.
- Timestamps use `createdAt` / `updatedAt` naming.
- Foreign keys follow `<entity>Id` naming (e.g., `userId`, `entryId`).
- Migrations are generated with `pnpm db:generate` and applied with `pnpm db:migrate`.
- Use `pnpm db:studio` to inspect the database via Drizzle Studio.
- Database scripts (migrations, seeds, init SQL) live in `scripts/db/`.
- The local dev database runs via `docker compose -f infra/docker/docker-compose.yml up -d postgres`.
- Connection string: `postgresql://annobib:annobib@localhost:5432/annobib` (dev default).
